<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="keywords"
      content="LSF, League of Silent Flight, radio control, R/C, sailplanes, contests, gliders, electric, altitude, AMRT, soaring, SAP"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LSF - League of Silent Flight</title>
    <link href="site.css" rel="stylesheet" type="text/css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link rel="icon" type="image/x-icon" href="images/favicon.ico" />
  </head>

  <body>
    <div class="overallcontainer">
      <header id="header-bar">
        <img src="images/LSFLogo.png" alt="LSF Logo" class="logo" />
        <p class="title_text">League of Silent Flight</p>
        <div id="user-controls">
          <div id="user-greeting" class="hidden">
            <button id="user-menu-btn">
              Welcome, <span id="user-name"></span> â–¾
            </button>
            <div id="user-dropdown" class="hidden">
              <a id="dashboard-link" href="dashboard.htm" target="main"
                >Dashboard</a
              >
              <a id="db-link" href="dbManager.php" target="main" class="hidden"
                >DB Manager</a
              >
              <a
                id="user-manager-link"
                href="queries/userManager.php"
                target="main"
                class="hidden"
                >User Manager</a
              >

              <a href="#" id="logout-link">Logout</a>
            </div>
          </div>
          <a id="login-btn" href="login.htm" target="main">Login</a>
        </div>
      </header>

      <div class="navbar" id="navbar">
        <!-- Navigation items (unchanged) -->
        <a href="index.html">Home</a>
        <div class="dropdown">
          <button class="dropbtn">
            LSF Program <i class="fa fa-caret-down"></i>
          </button>
          <div class="dropdown-content">
            <a href="LSFIntro.htm" target="main">Introduction to the LSF</a>
            <a href="LSFTasksAndTaskSheets.htm" target="main"
              >LSF Tasks & Task Sheets</a
            >
            <a href="data/LSFBylaws-2014.pdf" target="_blank"
              >LSF Bylaws (PDF)</a
            >
            <a href="LSFRulesIntrepretations.htm" target="main"
              >LSF Rules Interpretations</a
            >
            <a href="LSFApplication.htm" target="main">LSF Application</a>
            <a href="data/LSFStory.pdf" target="_blank"
              >How the LSF Began (PDF)</a
            >
            <a href="data/LSF SAP Achievement History.pdf" target="_blank"
              >LSF SAP - A Concise History (PDF)</a
            >
            <a href="data/Thermal Duration Competition.pdf" target="_blank"
              >Thermal Duration Guide (PDF)</a
            >
          </div>
        </div>
        <div class="dropdown">
          <button class="dropbtn">
            LSF Achievers <i class="fa fa-caret-down"></i>
          </button>
          <div class="dropdown-content">
            <a href="LSFLevelVs.htm" target="main">LSF Level V's</a>
            <a href="upgrades.htm?year=2025" target="main">2025 Upgrades</a>
            <a href="upgrades.htm?year=2024" target="main">2024 Upgrades</a>
            <a href="upgrades.htm?year=2023" target="main">2023 Upgrades</a>
            <a href="upgrades.htm?year=2022" target="main">2022 Upgrades</a>
            <a href="upgrades.htm?year=2021" target="main">2021 Upgrades</a>
            <a href="upgrades.htm?year=2020" target="main">2020 Upgrades</a>
            <a href="upgrades.htm?year=2019" target="main">2019 Upgrades</a>
            <a href="upgrades.htm?year=2018" target="main">2018 Upgrades</a>
            <a href="upgrades.htm?year=2017" target="main">2017 Upgrades</a>
            <a href="upgrades.htm?year=2016" target="main">2016 Upgrades</a>
            <a href="data/LSFMemberArchive-2Aug2017.pdf" target="_blank"
              >LSF Member Archive (PDF)</a
            >
          </div>
        </div>
        <div class="dropdown">
          <button class="dropbtn">
            LSF Events <i class="fa fa-caret-down"></i>
          </button>
          <div class="dropdown-content">
            <a href="LSFEvents.htm" target="main">2023 Nats</a>
          </div>
        </div>
        <a href="LSFNews.htm" target="main">News</a>
        <a href="https://lsfstore.qbstores.com/" target="_blank">LSF Store</a>
        <a href="LSFContact.htm" target="main">Contact Us</a>
        <a href="LSFLinks.htm" target="main">Links</a>
        <a href="LSFSilentWings.htm" target="main" id="swTab">Silent Wings</a>
      </div>

      <div class="container">
        <iframe class="responsive-iframe" name="main" src="main.htm"></iframe>
      </div>
      <div class="footer">
        <p class="footer_text">&copy; 2023 League of Silent Flight</p>
      </div>
    </div>

    <script>
      function updateAuthUI(data) {
        const loginBtn = document.getElementById("login-btn");
        const greeting = document.getElementById("user-greeting");
        const userName = document.getElementById("user-name");
        const dashboardLink = document.getElementById("dashboard-link");
        const dbLink = document.getElementById("db-link");
        const userManagerLink = document.getElementById("user-manager-link");
        const logoutLink = document.getElementById("logout-link");

        if (data.logged_in) {
          loginBtn.classList.add("hidden");
          greeting.classList.remove("hidden");
          userName.textContent = data.username;

          // Always show dashboard
          dashboardLink.classList.remove("hidden");

          // Show/hide admin links based on role
          if (data.role === "admin") {
            dbLink.classList.remove("hidden");
            userManagerLink.classList.remove("hidden");
          } else {
            dbLink.classList.add("hidden");
            userManagerLink.classList.add("hidden");
          }

          logoutLink.onclick = (e) => {
            e.preventDefault();
            fetch("queries/logout.php")
              .then((res) => res.json())
              .then(() => {
                document.querySelector("iframe[name='main']").src = "main.htm";
                greeting.classList.add("hidden");
                loginBtn.classList.remove("hidden");
                dbLink.classList.add("hidden");
                userManagerLink.classList.add("hidden");
              });
          };
        } else {
          greeting.classList.add("hidden");
          loginBtn.classList.remove("hidden");
          dbLink.classList.add("hidden");
          userManagerLink.classList.add("hidden");
        }
      }

      document.addEventListener("DOMContentLoaded", function () {
        // Toggle dropdown visibility
        const btn = document.getElementById("user-menu-btn");
        const menu = document.getElementById("user-dropdown");

        if (btn && menu) {
          btn.addEventListener("click", function (e) {
            e.stopPropagation();
            menu.classList.toggle("hidden");
          });

          document.addEventListener("click", function () {
            menu.classList.add("hidden");
          });
        }

        fetch("queries/auth_status.php")
          .then((response) => response.json())
          .then((data) => updateAuthUI(data))
          .catch((err) => console.error("Auth check failed:", err));
      });
    </script>
  </body>
</html>
